"use strict";(self.webpackChunkros_fe_poc=self.webpackChunkros_fe_poc||[]).push([[31],{2031:(Tt,C,o)=>{o.r(C),o.d(C,{BrakeTestTabModule:()=>gt});var f=o(8583),E=o(6983),t=o(7716);const se=[{Title:"Last brake test",StartDate:new Date(Date.now()-2),EndDate:new Date(Date.now()),Status:"Success"},{Title:"Automatic brake test",Status:"Disabled"},{Title:"Test2",StartDate:new Date(Date.now()-2),EndDate:new Date(Date.now()),Status:"Warn",Message:"Whoops I Slipped"},{Title:"Test3",StartDate:new Date(Date.now()-2),EndDate:new Date(Date.now()),Status:"Error",Message:"Boy you gonna need a new car"},{Title:"Test4",StartDate:new Date(Date.now()),Status:"Running"}];var p=o(3679),oe=o(9083),re=o(2938);const de={type:"get_brake_tests",data:{}};var g=o(3815),l=o(3065);const w=(0,l.PH)("[BrakeTest] Update Brake Test History",(0,l.Ky)()),pe=(0,l.Lq)({loading:!1,brakeTestHistory:[]},(0,l.on)(w,(a,i)=>Object.assign(Object.assign({},a),{brakeTestHistory:i.brakeTestHistory}))),H=(0,l.Tz)({name:"brakeTestHistory",reducer:pe}),ue=(0,l.P1)(H.selectBrakeTestHistory,a=>a);var he=o(6738),me=o(992),ge=o(3898),_=o(7736);let I=(()=>{class a{constructor(e,n,s,d){this.store=e,this.responseMW=n,this.channelsMW=s,this.linkService=d,this.responseMW.brakeTestHistory.subscribe(c=>{var r;c&&this.setBrakeTestHistory(null===(r=null==c?void 0:c.data)||void 0===r?void 0:r.brake_test.map(h=>({id:h.id,cycle:h.cycle,result:h.result,test_at:he(h.test_at,"YYYYMMDDThhmmss").format("YYYY-MM-DD hh:mm:ss").toLocaleString(),message:h.message,bms_max_i:h.bms_max_i.toFixed(2),left_max_i:h.left_max_i.toFixed(2),right_max_i:h.right_max_i.toFixed(2)})))})}get brakeTestHistory(){return this.store.select(ue)}setBrakeTestHistory(e){this.store.dispatch(w({brakeTestHistory:e}))}toggleBreakTest(e){this.channelsMW.toggleChannel("BrakeTestHistory",e)}fetchBrakeTestHistory(){let e=(0,g.cloneDeep)(de);this.linkService.sendMessage(e)}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(l.yh),t.LFG(me.B),t.LFG(ge.$),t.LFG(_.X))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const P=(0,l.PH)("[StaticBrakeTest] Update StaticBrakeTest",(0,l.Ky)()),R=(0,l.PH)("[StaticBrakeTest] Update StaticBrakeTest Time Interval",(0,l.Ky)()),F=(0,l.PH)("[StaticBrakeTest] Update StaticBrakeTest Error Time Threshold",(0,l.Ky)()),O=(0,l.PH)("[StaticBrakeTest] Update StaticBrakeTest Status",(0,l.Ky)()),be=(0,l.Lq)({loading:!1,staticBrakeTest:{enabled:!1,timeInterval:null,errorTimeThreshold:""}},(0,l.on)(P,(a,i)=>{let e=i.staticBrakeTest;return Object.assign(Object.assign({},a),{staticBrakeTest:e})}),(0,l.on)(R,(a,i)=>Object.assign(Object.assign({},a),{staticBrakeTest:Object.assign(Object.assign({},a.staticBrakeTest),{timeInterval:i.interval})})),(0,l.on)(F,(a,i)=>Object.assign(Object.assign({},a),{staticBrakeTest:Object.assign(Object.assign({},a.staticBrakeTest),{errorTimeThreshold:i.threshold})})),(0,l.on)(O,(a,i)=>Object.assign(Object.assign({},a),{staticBrakeTest:Object.assign(Object.assign({},a.staticBrakeTest),{enabled:i.status})}))),L=(0,l.Tz)({name:"staticBrakeTest",reducer:be}),xe=(0,l.P1)(L.selectStaticBrakeTest,a=>a),ke={type:"config",data:{request:"set",config:{ats_emulator:{ats_emulator:{start_brake_test:!0}}}}},Y={type:"config",data:{request:"set",config:{"ideal_brain.static_brake_test.brake_test_checker":{brake_test_checker:{max_brake_test_time_limit_h:""}}}}},N={type:"config",data:{request:"set",config:{"ideal_brain.static_brake_test.brake_test_checker":{brake_test_checker:{brake_test_time_interval_h:12}}}}},G={type:"config",data:{request:"set",config:{"ideal_brain.static_brake_test.brake_test_checker":{brake_test_checker:{disable_automatic_test:!0}}}}};var x=o(5257),B=o(729);let V=(()=>{class a{constructor(e,n){this.store=e,this.linkService=n,this.store.select(B.tg).subscribe(s=>{this.updateStaticBrakeTestTimeInterval(s)}),this.store.select(B.Vc).subscribe(s=>{this.updateStaticBrakeTestErrorTimeThreshold(s)}),this.store.select(B.vf).subscribe(s=>{this.updateStaticBreakTestStatus(void 0!==s?!s:void 0)})}get staticBrakeTest(){return this.store.select(xe)}setStaticBrakeTest(e){this.store.dispatch(P({staticBrakeTest:e}))}updateStaticBreakTestStatus(e){this.store.dispatch(O({status:e}))}updateStaticBrakeTestTimeInterval(e){this.store.dispatch(R({interval:e}))}updateStaticBrakeTestErrorTimeThreshold(e){this.store.dispatch(F({threshold:e}))}startStaticBrakeTest(e,n){let s=(0,g.cloneDeep)(ke);this.linkService.sendMessage(s),this.staticBrakeTest.pipe((0,x.q)(1)).subscribe(d=>{this.setStaticBrakeTest({enabled:d.enabled,timeInterval:e,errorTimeThreshold:n})})}submitStaticBrakeTest(e,n){N.data.config["ideal_brain.static_brake_test.brake_test_checker"].brake_test_checker.brake_test_time_interval_h=e;let s=(0,g.cloneDeep)(N);Y.data.config["ideal_brain.static_brake_test.brake_test_checker"].brake_test_checker.max_brake_test_time_limit_h=n;let d=(0,g.cloneDeep)(Y);setTimeout(()=>{this.linkService.sendMessage(s),setTimeout(()=>{this.linkService.sendMessage(d)},200)},200),this.staticBrakeTest.pipe((0,x.q)(1)).subscribe(c=>{this.setStaticBrakeTest({enabled:c.enabled,timeInterval:e,errorTimeThreshold:n})})}toggleStaticBreakTest(e){G.data.config["ideal_brain.static_brake_test.brake_test_checker"].brake_test_checker.disable_automatic_test=e;let n=(0,g.cloneDeep)(G);this.linkService.sendMessage(n),this.staticBrakeTest.pipe((0,x.q)(1)).subscribe(s=>{this.setStaticBrakeTest({enabled:!e,timeInterval:s.timeInterval,errorTimeThreshold:s.errorTimeThreshold})})}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(l.yh),t.LFG(_.X))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var ye=o(8011);const Z=(0,l.PH)("[DynamicBrakeTest] Update DynamicBrakeTest",(0,l.Ky)()),Be=(0,l.Lq)({loading:!1,dynamicBrakeTest:{enabled:!1,driveSpeed:""}},(0,l.on)(Z,(a,i)=>{let e=i.dynamicBrakeTest;return Object.assign(Object.assign({},a),{dynamicBrakeTest:e})})),j=(0,l.Tz)({name:"dynamicBrakeTest",reducer:Be}),Me=(0,l.P1)(j.selectDynamicBrakeTest,a=>a),Se={type:"config",data:{request:"set",config:{ats_emulator:{ats_emulator:{start_dynamic_brake_test:!0}}}}},Ae={type:"config",data:{request:"set",config:{ats_emulator:{ats_emulator:{start_mechanical_dynamic_brake_test:!0}}}}},De={type:"config",data:{request:"set",config:{"ideal_brain.dynamic_brake_test.drive_straight":{drive_straight:{speed:1}}}}};let J=(()=>{class a{constructor(e,n){this.store=e,this.linkService=n}get dynamicBrakeTest(){return this.store.select(Me)}setDynamicBrakeTest(e){this.store.dispatch(Z({dynamicBrakeTest:e}))}submitDynamicBrakeTest(e,n){let d,s=(0,g.cloneDeep)(De);s.data.config["ideal_brain.dynamic_brake_test.drive_straight"].drive_straight.speed=Number(e),d=(0,g.cloneDeep)(n?Ae:Se),setTimeout(()=>{this.linkService.sendMessage(s),setTimeout(()=>{this.linkService.sendMessage(d)},200)},200)}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(l.yh),t.LFG(_.X))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var Ce=o(9075),k=o(7093),Ee=o(7963),Q=o(8295),z=o(9983),U=o(1436),K=o(1095),we=o(5424);const He=["brakeTestTable"];function Ie(a,i){if(1&a&&t._UZ(0,"app-data-table",16,17),2&a){const e=t.oxw(2);t.Q6J("title","Brake test history")("columns",e.columns)("ELEMENT_DATA",e.tableData)("showReloadButton",!0)("reloadButtonTrigger",e.reloadBrakeTestHistory)}}function Pe(a,i){if(1&a){const e=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.TgZ(2,"div",3),t.TgZ(3,"app-switch-tile",4),t.NdJ("slideAction",function(s){return t.CHM(e),t.oxw().toggleStaticBrakeTest(s)}),t.qZA(),t.TgZ(4,"form",5),t.TgZ(5,"mat-form-field"),t._UZ(6,"input",6),t.qZA(),t.TgZ(7,"div",7),t.TgZ(8,"mat-form-field",8),t._UZ(9,"input",9),t.qZA(),t._UZ(10,"i",10),t.qZA(),t.qZA(),t.TgZ(11,"div",11),t.TgZ(12,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().startStaticBrakeTest()}),t._uU(13," Start test"),t.qZA(),t.TgZ(14,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().onStaticBrakeTestTimeValuesSubmit()}),t._uU(15," Submit"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",13),t.TgZ(17,"app-switch-tile",14),t.NdJ("slideAction",function(s){return t.CHM(e),t.oxw().toggleDynamicBrakeTest(s)})("inputActionEmit",function(s){return t.CHM(e),t.oxw().onDynamicBrakeTestSubmit(s)}),t.qZA(),t.qZA(),t.qZA(),t.YNc(18,Ie,2,5,"app-data-table",15),t.qZA()}if(2&a){const e=t.oxw();t.xp6(3),t.Q6J("description",e.getStaticBrakeTestDescription())("initialValue",e.initialStaticBrakeTestValue)("slideTextDisabled","Disabled"),t.xp6(1),t.Q6J("formGroup",e.staticBrakeTestFormGroup),t.xp6(6),t.Q6J("matTooltip",e.Description),t.xp6(7),t.Q6J("inputAction",e.action)("initialValue",e.initialDynamicBrakeTestValue),t.xp6(1),t.Q6J("ngIf",e.tableData)}}const Re=[{path:"",component:(()=>{class a{constructor(e,n,s,d,c){this.brakeTestHistoryMS=e,this.staticBrakeTestMS=n,this.notificationBarMs=s,this.dynamicBrakeTestMS=d,this.sanitizer=c,this.attemptedBrakeTests=se,this.subscriptions=[],this.initialStaticBrakeTestValue=void 0,this.initialDynamicBrakeTestValue=void 0,this.Description="Time threshold (in hours) between static brake tests before and error event is reported.",this.staticBrakeTestFormGroup=new p.cw({timeInterval:new p.NI("",[p.kI.required,p.kI.min(0)]),errorTimeThreshold:new p.NI("",[p.kI.required])}),this.columns=[{id:"id",name:"Id",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}},{id:"cycle",name:"Cycle",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}},{id:"result",name:"Result",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>!0===r?"SUCCESS":"FAILURE",badgeBackgroundColorRule:r=>!0===r?"#DEFFEE":"#FFDEDE"}},{id:"time",name:"Time",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}},{id:"message",name:"Message",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}},{id:"bms_max_i",name:"Bms Max I",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}},{id:"left_max_i",name:"Left Motor Max I",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}},{id:"right_max_i",name:"Right Motor Max I",badge:{badgeCell:!0,badgeColorRule:r=>"#425466",badgeValueRule:r=>r,badgeBackgroundColorRule:r=>"transparent"}}],this.tableData=[],this.action={input:null,inputPlaceholder:"Input drive speed",trigger(){}},this.reloadBrakeTestHistory=()=>{this.brakeTestHistoryMS.fetchBrakeTestHistory()}}toggleStaticBrakeTest(e){this.initialStaticBrakeTestValue=e,this.staticBrakeTestMS.toggleStaticBreakTest(!e)}onStaticBrakeTestTimeValuesSubmit(){this.staticBrakeTestMS.submitStaticBrakeTest(this.staticBrakeTestFormGroup.controls.timeInterval.value,this.staticBrakeTestFormGroup.controls.errorTimeThreshold.value)}startStaticBrakeTest(){this.staticBrakeTestMS.startStaticBrakeTest(this.staticBrakeTestFormGroup.controls.timeInterval.value,this.staticBrakeTestFormGroup.controls.errorTimeThreshold.value)}toggleBrakeTestChannel(e){this.brakeTestHistoryMS.toggleBreakTest(e)}toggleDynamicBrakeTest(e){this.initialDynamicBrakeTestValue=e}onDynamicBrakeTestSubmit(e){this.dynamicBrakeTestMS.submitDynamicBrakeTest(e,this.initialDynamicBrakeTestValue)}ngOnInit(){this.subscriptions.push(this.staticBrakeTestMS.staticBrakeTest.subscribe(e=>{e&&(this.initialStaticBrakeTestValue=e.enabled,this.staticBrakeTestFormGroup.controls.errorTimeThreshold.setValue(e.errorTimeThreshold),this.staticBrakeTestFormGroup.controls.timeInterval.setValue(e.timeInterval))}),this.dynamicBrakeTestMS.dynamicBrakeTest.subscribe(e=>{e&&(this.initialDynamicBrakeTestValue=e.enabled,this.action.input=e.driveSpeed)}),this.brakeTestHistoryMS.brakeTestHistory.subscribe(e=>{var n;let s=null==e?void 0:e.map((d,c)=>({id:d.id,cycle:d.cycle,result:d.result,time:d.test_at,message:d.message,bms_max_i:d.bms_max_i,left_max_i:d.left_max_i,right_max_i:d.right_max_i}));(0,oe.diff)(this.tableData,s)&&(this.tableData=s,null===(n=this.brakeTestTable)||void 0===n||n.setTableData(this.tableData))})),this.notificationBarMs.addNotificationBar({id:"brakeTestWarning",closable:!0,content:"Only preform saftey tests in safe conditions, ensure personel are clear.",severity:re.l.WARNING}),this.toggleBrakeTestChannel(!0),this.brakeTestHistoryMS.fetchBrakeTestHistory()}getStaticBrakeTestDescription(){return this.sanitizer.sanitize(t.q3G.HTML,"Automatically performed on a <span>"+this.staticBrakeTestFormGroup.controls.timeInterval.value+"hr</span> cycle.")}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.toggleBrakeTestChannel(!1),this.notificationBarMs.removeNotificationBar("brakeTestWarning")}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(I),t.Y36(V),t.Y36(ye.Y),t.Y36(J),t.Y36(Ce.H7))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-device-identity-tab"]],viewQuery:function(e,n){if(1&e&&t.Gf(He,5),2&e){let s;t.iGM(s=t.CRH())&&(n.brakeTestTable=s.first)}},decls:1,vars:1,consts:[["fxLayout","column","fxLayoutGap","16px","class","outer-div-padding","style","height: 100%; color: black;overflow: auto",4,"ngIf"],["fxLayout","column","fxLayoutGap","16px",1,"outer-div-padding",2,"height","100%","color","black","overflow","auto"],["fxLayout","row wrap","fxLayoutGap.gt-sm","30px",2,"width","100%"],["fxFlex.sm","100","fxLayoutGap","16px",1,"page-components","card-max-360","full-width-mobile"],["title","Static brake test","slideText","Enabled",3,"description","initialValue","slideTextDisabled","slideAction"],["fxLayout","column",3,"formGroup"],["matInput","","type","number","placeholder","Time Interval (h)","formControlName","timeInterval"],["fxFlex","row","fxLayoutGap","16px","fxLayoutAlign","center center"],["fxFlex","start"],["matInput","","type","number","placeholder","Error Time Threshold (h)","formControlName","errorTimeThreshold"],["fxLayoutAlign","end",1,"bi","bi-info-circle-fill",2,"cursor","pointer",3,"matTooltip"],["fxLayout","row wrap","fxLayoutAlign","space-between center"],["mat-flat-button","","color","accent",3,"click"],["fxFlex.sm","100",1,"page-components","card-max-360","full-width-mobile"],["title","Dynamic brake test","description","Trigger manually to test brake function. ","slideText","Test mechanical brakes",3,"inputAction","initialValue","slideAction","inputActionEmit"],["title","Tests",3,"title","columns","ELEMENT_DATA","showReloadButton","reloadButtonTrigger",4,"ngIf"],["title","Tests",3,"title","columns","ELEMENT_DATA","showReloadButton","reloadButtonTrigger"],["brakeTestTable",""]],template:function(e,n){1&e&&t.YNc(0,Pe,19,8,"div",0),2&e&&t.Q6J("ngIf",null!=n.initialStaticBrakeTestValue)},directives:[f.O5,k.xw,k.SQ,k.yH,Ee.s,p._Y,p.JL,p.sg,Q.KE,z.Nt,p.wV,p.Fj,p.JJ,p.u,k.Wh,U.gM,K.lW,we.Q],styles:[""]}),a})()},{path:"**",redirectTo:""}];let Fe=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[E.Bz.forChild(Re)],E.Bz]}),a})();var Oe=o(9904),Le=o(2685);let Ye=(()=>{class a{constructor(){}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Ne=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[Ye,V,J,I],imports:[[f.ez,l.Aw.forFeature(j),l.Aw.forFeature(L),l.Aw.forFeature(H)]]}),a})();var Ge=o(3059),Ve=o(1769),Ze=o(7746),je=o(7909);o(9490),o(9765),o(5319),o(8345);let We=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({}),a})();var S=o(7636),$=o(2458);o(9238),o(7519),o(9761),o(5435),o(6461),o(6237),o(9193),o(6682),o(7238);let mt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[f.ez,$.BQ,We,S.eL]]}),a})(),gt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[f.ez,Fe,Oe.A,Le.t,Ne,Ge.i,Q.lN,p.u5,p.UX,Ve.t,Ze.ie,je.o9,mt,z.c,K.ot,U.AV]]}),a})()}}]);