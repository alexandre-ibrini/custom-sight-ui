"use strict";(self.webpackChunkros_fe_poc=self.webpackChunkros_fe_poc||[]).push([[547],{23547:(Ve,M,l)=>{l.r(M),l.d(M,{PersistentParamsModule:()=>we});var D=l(65939),P=l(95987),f=l(38583),C=l(26215),I=l(25917),J=l(43190),E=l(54395),g=l(23815),_=l(6040),L=l(2938),e=l(37716);const Q={type:"get_persistent_params",data:{}},B={type:"set_persistent_params",data:{}};var u=l(23065);const b=(0,u.PH)("[PersistentParams] Update PersistentParamsMetadata",(0,u.Ky)()),Y=(0,u.Lq)({loading:!1,metadata:null},(0,u.on)(b,(n,d)=>Object.assign(Object.assign({},n),{metadata:d.metadata}))),A=(0,u.Tz)({name:"persistentParamsMetadata",reducer:Y}),H=(0,u.P1)(A.selectMetadata,n=>n),N=(0,u.PH)("[PersistentParams] Update PersistentParams",(0,u.Ky)()),U=(0,u.Lq)({loading:!1,persistentParams:null},(0,u.on)(N,(n,d)=>Object.assign(Object.assign({},n),{persistentParams:d.persistentParams}))),Z=(0,u.Tz)({name:"persistentParams",reducer:U}),$=(0,u.P1)(Z.selectPersistentParams,n=>n);let O=(()=>{class n{constructor(){this.getDisplayType=t=>"number"==typeof t?"number":"boolean"==typeof t?"boolean":"text"}mapFromDtoToViewModel(t){return this.getChildrenRecursive(t)}getChildrenRecursive(t,a){var i;let s,r=[],o=1;a?r=a.split("."):s="1";let c=this.getObjectKeys(t);if((null==c?void 0:c.length)<=0)return[];let y,p=[];for(let v of c){s=null==r?void 0:r.concat(o.toString()).join(".");let T=(null===(i=this.getObjectKeys(t[v]))||void 0===i?void 0:i.length)>0&&"string"!=typeof t[v],Fe=T&&Array.isArray(t[v]);y={id:s,parentId:a,name:v,children:T?this.getChildrenRecursive(t[v],s):null,value:T?null:t[v],isArray:Fe,displayType:T?null:this.getDisplayType(t[v]),options:null},p.push(y),o++}return p}getObjectKeys(t){if(t){let a=[];for(const i in t)a.push(i);return a}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var X=l(70992),q=l(67736);let S=(()=>{class n{constructor(t,a,i,r){this.store=t,this.mapper=a,this.responseMS=i,this.linkService=r,this.responseMS.get_persistent_params.subscribe(s=>{var o;this.receivePersistentParamsMetadata(null===(o=null==s?void 0:s.data)||void 0===o?void 0:o.metadata),this.receivePersistentParams(null==s?void 0:s.data.preserved_params)}),this.responseMS.set_persistent_params.subscribe(s=>{})}get PersistentParams(){return this.store.select($)}get persistentParamsMetadata(){return this.store.select(H)}requestPersistentParams(){let t=(0,g.cloneDeep)(Q);this.linkService.sendMessage(t)}receivePersistentParams(t){let a=this.mapper.mapFromDtoToViewModel(t);this.store.dispatch(N({persistentParams:a}))}receivePersistentParamsMetadata(t){this.store.dispatch(b({metadata:t}))}setPersistentParams(t){let a=(0,g.cloneDeep)(B);a.data=t,this.linkService.sendMessage(a)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(u.yh),e.LFG(O),e.LFG(X.B),e.LFG(q.X))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var W=l(27276),k=l(58011),m=l(77093),w=l(98295),F=l(49983),h=l(3679),V=l(51095),j=l(11436),x=l(51295),ee=l(97728),te=l(67441),ae=l(72458),ne=l(7539);const ie=["tree"];function se(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",13),e.TgZ(1,"input",14),e.NdJ("ngModelChange",function(i){e.CHM(t);const r=e.oxw(3).$implicit;return e.oxw(2).ngModelChanged(r,i)}),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(3).$implicit;e.xp6(1),e.Q6J("type",t.data.displayType)("ngModel",t.data.value)}}function re(n,d){if(1&n&&(e.ynx(0),e.TgZ(1,"mat-option",17),e._uU(2),e.qZA(),e.BQk()),2&n){const t=d.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function oe(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",13),e.TgZ(1,"mat-select",15),e.NdJ("valueChange",function(i){return e.CHM(t),e.oxw(3).$implicit.data.value=i})("valueChange",function(i){e.CHM(t);const r=e.oxw(3).$implicit;return e.oxw(2).ngModelChanged(r,i)}),e.YNc(2,re,3,2,"ng-container",16),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(3).$implicit;e.xp6(1),e.Q6J("value",t.data.value),e.xp6(1),e.Q6J("ngForOf",t.data.options)}}function le(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"mat-checkbox",18),e.NdJ("change",function(i){e.CHM(t);const r=e.oxw(3).$implicit;return e.oxw(2).ngModelChanged(r,i.checked)}),e.qZA()}if(2&n){const t=e.oxw(3).$implicit;e.Q6J("checked",t.data.value)}}function de(n,d){if(1&n&&(e.ynx(0),e.YNc(1,se,2,2,"mat-form-field",11),e.YNc(2,oe,3,2,"mat-form-field",11),e.YNc(3,le,1,1,"mat-checkbox",12),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",!((null==t||null==t.data||null==t.data.options?null:t.data.options.length)>0)&&"boolean"!==t.data.displayType),e.xp6(1),e.Q6J("ngIf",(null==t||null==t.data||null==t.data.options?null:t.data.options.length)>0),e.xp6(1),e.Q6J("ngIf","boolean"===t.data.displayType)}}function ce(n,d){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(t.data.value)}}function ue(n,d){if(1&n&&(e.TgZ(0,"div",9),e.YNc(1,de,4,3,"ng-container",10),e.YNc(2,ce,2,1,"span",10),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.areValuesEditable),e.xp6(1),e.Q6J("ngIf",!t.areValuesEditable)}}function pe(n,d){if(1&n&&(e.TgZ(0,"div",7),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"titlecase"),e.qZA(),e.YNc(4,ue,3,2,"div",8),e.qZA()),2&n){const t=d.$implicit;e.xp6(2),e.Oqu(e.lcZ(3,2,t.data.name)),e.xp6(2),e.Q6J("ngIf",null!==t.data.value&&(null==t.data||null==t.data.children?null:t.data.children.length)<=0)}}function me(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"div",2),e.TgZ(2,"tree-root",3,4),e.YNc(4,pe,5,4,"ng-template",null,5,e.W1O),e.qZA(),e.qZA(),e.TgZ(6,"div"),e.TgZ(7,"button",6),e.NdJ("click",function(){return e.CHM(t),e.oxw().submit()}),e._uU(8),e.ALo(9,"transloco"),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("nodes",t.dataSource)("options",t.treeOptions),e.xp6(5),e.Q6J("disabled",!t.changedValues),e.xp6(1),e.Oqu(e.lcZ(9,4,"nestedTree.buttons.submit"))}}let he=(()=>{class n{constructor(){this.data=new e.IIB,this.areValuesEditable=new e.IIB,this.submitPressed=new e.vpe,this.dataSource=new Array,this.hasChild=(t,a)=>!!a.children&&a.children.length>0,this.treeOptions={animateExpand:!0,displayField:"name",allowDragoverStyling:!1,allowDrag:!1,allowDrop:!1,actionMapping:{mouse:{click:x.iM.TOGGLE_EXPANDED}}},this.searchSubject=new C.X(null)}search(t){var a;this.tree.treeModel.filterNodes(i=>i.data.name.includes(t),!1),null===(a=this.tree.treeModel.getVisibleRoots())||void 0===a||a.forEach(i=>{this.setNodesVisibleRecursive(i)})}setNodesVisibleRecursive(t){var a;t.setIsHidden(!1),null===(a=t.children)||void 0===a||a.forEach(i=>{this.setNodesVisibleRecursive(i)})}setData(t){this.data=t,this.dataSource=(0,g.cloneDeep)(t),this.changedValues=!1}ngModelChanged(t,a){t.data.value="number"===t.data.displayType?Number(a):a,this.onValueChange(t)}ngOnInit(){this.dataSource=(0,g.cloneDeep)(this.data)}onValueChange(t){this.changedValues||(this.changedValues={});let a=this.getNodePathsList(t),i=a[a.length-2].isArray,r=i?a[a.length-2].id:null,s=i?Number(a[a.length-1].name):null;this.setNestedKeys(this.changedValues,a,t.data.value,r,s)}setNestedKeys(t,a,i,r,s){r&&s>=0&&a.splice(a.length-1,1),a.forEach((o,c)=>{if(r&&s>=0)c===a.length-1?(t[o.name]||(t[o.name]=this.findArrayValues(r)),t[o.name][s]=i):t[o.name]||(t[o.name]=t[o.name]?t[o.name]:{});else if(c===a.length-1)t[o.name]=ee.b.isNullOrUndefined(i)?t[o.name]:i;else if(t[o.name])t[o.name]=t[o.name];else if(o.isArray){t[o.name]=[];let p=this.getMidObjectArrayValues(o.id);t[o.name].push(...p),a[c+1]=Number(a[c+1])}else t[o.name]={};t=t[o.name]})}getMidObjectArrayValues(t){var a;let i=this.getCurrentObjectById(t),r=[];return null===(a=null==i?void 0:i.children)||void 0===a||a.forEach((s,o)=>{var c;r[o]={},null===(c=null==s?void 0:s.children)||void 0===c||c.forEach(p=>{this.getNestedKeysFromDataObject(p,r[o])})}),r}getNestedKeysFromDataObject(t,a){var i;if(t.isArray){let r=[];null===(i=null==t?void 0:t.children)||void 0===i||i.forEach((s,o)=>{var c;s.value?r[o]=s.value:(r[o]={},null===(c=null==s?void 0:s.children)||void 0===c||c.forEach(p=>{this.getNestedKeysFromDataObject(p,r[o])}))}),a||(a={}),a[t.name]=r}else a||(a={}),t.children?t.children.forEach((r,s)=>a[t.name]=this.getNestedKeysFromDataObject(r,a[t.name])):a[t.name]=t.value;return a}getCurrentObjectById(t){var a;let i=t.split("."),r=this.dataSource.find(o=>(null==o?void 0:o.id)===i[0]),s=1;for(;s<i.length;){let o=i.slice(0,s+1).join(".");r=null===(a=null==r?void 0:r.children)||void 0===a?void 0:a.find(c=>(null==c?void 0:c.id)===o),s++}return r}findArrayValues(t){var a;let i=this.getCurrentObjectById(t),r=[];return r=null===(a=null==i?void 0:i.children)||void 0===a?void 0:a.map(s=>null==s?void 0:s.value),r}getObjectNestedPathsList(t){var a,i;let r=[];return r.push([{id:t.id,name:t.name,isArray:t.isArray}]),(null===(a=null==t?void 0:t.children)||void 0===a?void 0:a.length)>0&&(null===(i=null==t?void 0:t.children)||void 0===i||i.forEach((s,o)=>{r.push(this.getObjectNestedPathsList(s))})),r}getNodePathsList(t){var a,i,r;let s=t,o=[];for(;s&&!s.data.virtual;){let c={id:null===(a=s.data)||void 0===a?void 0:a.id,name:null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.name,isArray:null===(r=null==s?void 0:s.data)||void 0===r?void 0:r.isArray};o.splice(0,0,c),s=s.parent}return o}submit(){this.submitPressed.emit(this.changedValues)}reset(){this.dataSource=(0,g.cloneDeep)(this.data),this.changedValues={}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-nested-tree"]],viewQuery:function(t,a){if(1&t&&e.Gf(ie,5),2&t){let i;e.iGM(i=e.CRH())&&(a.tree=i.first)}},inputs:{data:"data",areValuesEditable:"areValuesEditable"},outputs:{submitPressed:"submitPressed"},features:[e._Bn([{provide:_.Hn,useValue:{scope:"libs/shared/components/nested-tree",alias:"nestedTree"}}])],decls:1,vars:1,consts:[["style","height:100%; overflow: auto;","fxLayout","row","class","outerDiv",4,"ngIf"],["fxLayout","row",1,"outerDiv",2,"height","100%","overflow","auto"],["fxFlex",""],[1,"tree",3,"nodes","options"],["tree",""],["treeNodeTemplate",""],["mat-flat-button","","color","accent",3,"disabled","click"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","64px","fxFlexFill","",2,"width","100%"],["fxLayoutGap","16px",4,"ngIf"],["fxLayoutGap","16px"],[4,"ngIf"],["appearance","outline",4,"ngIf"],[3,"checked","change",4,"ngIf"],["appearance","outline"],["matInput","","step","0.1",1,"nodeValue",3,"type","ngModel","ngModelChange"],[3,"value","valueChange"],[4,"ngFor","ngForOf"],[3,"value"],[3,"checked","change"]],template:function(t,a){1&t&&e.YNc(0,me,10,6,"div",0),2&t&&e.Q6J("ngIf",a.dataSource.length>0)},directives:[f.O5,m.xw,m.yH,x.qr,V.lW,m.Wh,m.SQ,m.s9,w.KE,F.Nt,h.Fj,h.JJ,h.On,te.gD,f.sg,ae.ey,ne.oG],pipes:[_.Ot,f.rS],styles:[".tree[_ngcontent-%COMP%]  .node-content-wrapper-active, .node-content-wrapper.node-content-wrapper-active[_ngcontent-%COMP%]:hover, .node-content-wrapper-active.node-content-wrapper-focused[_ngcontent-%COMP%]{background:transparent!important}.tree[_ngcontent-%COMP%]  .node-content-wrapper-active, .node-content-wrapper-focused[_ngcontent-%COMP%], .node-content-wrapper[_ngcontent-%COMP%]:hover{box-shadow:none!important}.tree[_ngcontent-%COMP%]  .node-content-wrapper-focused{background:transparent!important}.nodeValue[_ngcontent-%COMP%]{color:var(--accent-color)}.outerDiv[_ngcontent-%COMP%]  .mat-select-value-text{color:var(--accent-color)}.outerDiv[_ngcontent-%COMP%]  .mat-form-field-appearance-outline .mat-form-field-infix{padding:.75em 0 .5em}.outerDiv[_ngcontent-%COMP%]  .mat-form-field-wrapper{padding-bottom:0}"]}),n})();var ve=l(88623);const fe=["tree"];function ge(n,d){if(1&n){const t=e.EpF();e.TgZ(0,"div",13),e.TgZ(1,"app-nested-tree",14,15),e.NdJ("submitPressed",function(i){return e.CHM(t),e.oxw().submitPressed(i)}),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("data",t.data)}}function _e(n,d){1&n&&(e.TgZ(0,"div",13),e._UZ(1,"app-empty-data"),e.qZA())}let Pe=(()=>{class n{constructor(t,a,i,r){this.persistentParamsMS=t,this.snackbar=a,this.notificationBarMS=i,this.translocoService=r,this.searchFieldValue="",this.subscriptions=[],this.data=[],this.searchSubject=new C.X(null),this.metadataTable=[]}submitPressed(t){this.persistentParamsMS.setPersistentParams(t),this.translocoService.selectTranslate("snackBar.valueChangeSuccess",{},"modules/pages/safety").subscribe(a=>{this.snackbar.openSnackBar(a,null,{verticalPosition:"top",horizontalPosition:"right"})})}ngOnInit(){this.subscriptions.push(this.persistentParamsMS.persistentParamsMetadata.subscribe(t=>{this.metadata=t,this.data=this.setDataOptions()}),this.persistentParamsMS.PersistentParams.subscribe(t=>{var a;t&&(this.data=t,this.data=this.setDataOptions(),null===(a=this.tree)||void 0===a||a.setData(this.data))}),this.searchSubject.pipe((0,J.w)(t=>(0,I.of)(t)),(0,E.b)(300)).subscribe(t=>{null!=t&&this.tree.search(t)})),this.notificationBarMS.addNotificationBar({id:"persistentParamsInfo",closable:!0,severity:L.l.INFO,isDescriptionAvailable:!0,description:{initialText:"notificationBar.persistentParams.description.initialText",additionalText:"notificationBar.persistentParams.description.additionalText",buttonText:"notificationBar.persistentParams.description.buttonText"}}),this.persistentParamsMS.requestPersistentParams()}setDataOptions(){var t;let a=(0,g.cloneDeep)(this.data);if(this.metadataTable=[],this.metadata&&a)return this.iterateObjectKeys(this.metadata,a),null===(t=this.metadataTable)||void 0===t||t.forEach(i=>{var r;let s=null===(r=null==i?void 0:i.id)||void 0===r?void 0:r.split("."),o=a.find(c=>c.id===s[0]);null==s||s.forEach((c,p)=>{p>0&&(o=o.children.find(y=>y.id===s.slice(0,p+1).join(".")))}),o&&(o.options=null==i?void 0:i.values)}),a}iterateObjectKeys(t,a,i){Object.keys(t).forEach(r=>{let s=null==a?void 0:a.find(o=>o.name===r);"values"!==r?this.iterateObjectKeys(t[r],null==s?void 0:s.children,s):this.metadataTable.push({id:null==i?void 0:i.id,values:t[r]})})}reloadParams(){this.persistentParamsMS.requestPersistentParams()}setSearchSubjectNext(t){this.searchSubject.next(t)}ngOnDestroy(){this.notificationBarMS.removeNotificationBar("persistentParamsInfo"),this.subscriptions.forEach(t=>t.unsubscribe())}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(S),e.Y36(W.o),e.Y36(k.Y),e.Y36(_.Vn))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-parameters-tab"]],viewQuery:function(t,a){if(1&t&&e.Gf(fe,5),2&t){let i;e.iGM(i=e.CRH())&&(a.tree=i.first)}},features:[e._Bn([{provide:_.Hn,useValue:{scope:"modules/pages/persistent-params",alias:"persistentParams"}}])],decls:19,vars:13,consts:[[1,"outer-div-padding"],["fxLayout","row wrap","fxLayoutGap","7px",2,"height","100%"],["fxLayout","row",1,"page-components","unselectable","full-width-mobile",2,"min-width","260px","width","100%","height","20%"],["fxFlex","50","fxLayoutGap","8px",1,"search-div"],[2,"width","100%",3,"appearance"],["fxFlexAlign","end",1,"bi","bi-search"],["matInput","","type","text",1,"search",3,"ngModel","placeholder","ngModelChange"],["fxFlex",""],["mat-flat-button","",1,"reload-button",3,"click"],["fxLayoutAlign","center center",3,"matTooltip"],["fxFlexAlign","end",1,"bi","bi-arrow-counterclockwise","icon-reload"],[2,"vertical-align","center"],["class","page-components unselectable full-width-mobile","style"," min-width: 260px; width: 100%; height:100%;",4,"ngIf"],[1,"page-components","unselectable","full-width-mobile",2,"min-width","260px","width","100%","height","100%"],[3,"data","submitPressed"],["tree",""]],template:function(t,a){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"div",3),e.TgZ(4,"mat-form-field",4),e._UZ(5,"i",5),e.TgZ(6,"input",6),e.NdJ("ngModelChange",function(r){return a.searchFieldValue=r})("ngModelChange",function(r){return a.setSearchSubjectNext(r)}),e.ALo(7,"transloco"),e.qZA(),e.qZA(),e.qZA(),e._UZ(8,"div",7),e.TgZ(9,"div"),e.TgZ(10,"button",8),e.NdJ("click",function(){return a.reloadParams()}),e.TgZ(11,"div",9),e.ALo(12,"transloco"),e._UZ(13,"i",10),e.TgZ(14,"span",11),e._uU(15),e.ALo(16,"transloco"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(17,ge,3,1,"div",12),e.YNc(18,_e,2,0,"div",12),e.qZA(),e.qZA()),2&t&&(e.xp6(4),e.Q6J("appearance","standard"),e.xp6(2),e.s9C("placeholder",e.lcZ(7,7,"persistentParams.search.placeholder")),e.Q6J("ngModel",a.searchFieldValue),e.xp6(5),e.Q6J("matTooltip",e.lcZ(12,9,"persistentParams.buttons.reload.tooltip")),e.xp6(4),e.Oqu(e.lcZ(16,11,"persistentParams.buttons.reload.name")),e.xp6(2),e.Q6J("ngIf",(null==a.data?null:a.data.length)>0),e.xp6(1),e.Q6J("ngIf",0===(null==a.data?null:a.data.length)))},directives:[m.xw,m.SQ,m.yH,w.KE,m.XD,F.Nt,h.Fj,h.JJ,h.On,V.lW,m.Wh,j.gM,f.O5,he,ve.M],pipes:[_.Ot],styles:[".reload-button[_ngcontent-%COMP%]{background-color:var(--grey-color);border-radius:20px;font-weight:bold}.icon-reload[_ngcontent-%COMP%]{position:relative;font-size:20px;transform:rotate(320deg)}.search-div[_ngcontent-%COMP%]{height:35px}.search[_ngcontent-%COMP%]{height:100%;width:70%;padding-left:5px}.bi-search[_ngcontent-%COMP%]{font-size:13px;position:relative;top:-2px}  .mat-form-field-underline{display:none}  .mat-form-field-infix{border:0;margin-left:20px;padding:0}"]}),n})();var ye=l(64565),Te=l(48102);const xe=[{path:"params",component:Pe,canActivate:[ye.p],data:{role:Te.G.Admin}},{path:"**",redirectTo:"params"}];let Me=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[P.Bz.forChild(xe)],P.Bz]}),n})();var Ce=l(27909);let be=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[S,O],imports:[[f.ez,u.Aw.forFeature(Z),u.Aw.forFeature(A)]]}),n})();var Ae=l(69904),Ne=l(60980),Ze=l(74975),Oe=l(2674),Se=l(55906);let we=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[f.ez,Me,Ce.o9,P.Bz.forChild([]),Ae.A,P.Bz,D.Nh,Ne.G,x.xc,h.u5,Ze.Q,Oe.z,be,Se.E,_.y4]]}),n})()}}]);