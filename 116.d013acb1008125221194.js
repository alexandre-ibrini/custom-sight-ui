"use strict";(self.webpackChunkros_fe_poc=self.webpackChunkros_fe_poc||[]).push([[116],{75116:(le,I,l)=>{l.r(I),l.d(I,{NetworkingModule:()=>ae});var g=l(38583),C=l(95987),c=l(3679),_=l(19083),u=l(23815);const L={"Device Identity":{fields:[{displayName:"Hostname",fieldName:"hostname",placeholder:"Add your host",fieldState:"",type:"String",validators:[],disabled:!0}]},Interfaces:{fields:[{displayName:"Hostname",fieldName:"hostname",placeholder:"Add your host",type:"String",fieldState:"",validators:[],disabled:!0},{displayName:"IP address",fieldName:"ipAddress",placeholder:"Add your Ip address",type:"String",fieldState:"",validators:[],disabled:!0},{displayName:"Mask",fieldName:"mask",placeholder:"Add your mask",type:"String",fieldState:"",validators:[],disabled:!0},{displayName:"Gateway",fieldName:"gateway",placeholder:"Add your gateway",type:"String",fieldState:"",validators:[],disabled:!0},{displayName:"Interfaces",fieldName:"interfaces",placeholder:"",fieldState:"",type:"Select",options:[],display:"inline",validators:[]}]}};var e=l(37716),a=l(23065);const y=(0,a.PH)("[Interfaces] Update Interfaces",(0,a.Ky)()),U=(0,a.Lq)({loading:!1,interfaces:void 0},(0,a.on)(y,(i,o)=>Object.assign(Object.assign({},i),{interfaces:o.interfaces}))),N=(0,a.Tz)({name:"interfaces",reducer:U}),D=(0,a.P1)(N.selectInterfaces,i=>i);var x=l(92340),w=l(91841);let Z=(()=>{class i{constructor(t){this.http=t,this.baseUrl=x.N.OnboardingApiEndpoint,this.getInterfacesUrl=this.baseUrl+"interface"}getInterfaces(){return this.http.get(this.getInterfacesUrl)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(w.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),k=(()=>{class i{constructor(t,n){this.store=t,this.interfaceApiService=n}get interfaces(){return this.store.select(D)}getInterfaceByName(t){return this.store.select((i=>(0,a.P1)(N.selectInterfaces,o=>null==o?void 0:o.find(t=>t.name===i)))(t))}fetchInterfaces(){this.interfaceApiService.getInterfaces().subscribe(t=>{this.setInterfaces(t)})}setInterfaces(t){this.store.dispatch(y({interfaces:t}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(a.yh),e.LFG(Z))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const P=(0,a.PH)("[Provisioning] Update Provisioning",(0,a.Ky)()),Q=(0,a.Lq)({loading:!1,provisioning:{hostname:{hostname:""},name_servers:{dns:{ips:[]},fallback:{ips:[]}},ntp:{ips:[]}}},(0,a.on)(P,(i,o)=>Object.assign(Object.assign({},i),{provisioning:o.provisioning}))),m=(0,a.Tz)({name:"provisioning",reducer:Q}),Y=(0,a.P1)(m.selectProvisioning,i=>i),V=(0,a.P1)(m.selectProvisioning,i=>null==i?void 0:i.name_servers),H=(0,a.P1)(m.selectProvisioning,i=>{var o;return null===(o=null==i?void 0:i.ntp)||void 0===o?void 0:o.ips});let A=(()=>{class i{constructor(t){this.http=t,this.baseUrl=x.N.OnboardingApiEndpoint,this.getAndPostAllProvisioningUrl=this.baseUrl+"provisioning",this.PostProvisioningNtpUrl=this.baseUrl+"provisioning/ntp",this.PostProvisioningDnsUrl=this.baseUrl+"provisioning/dns",this.PostProvisioningHostnameUrl=this.baseUrl+"provisioning/hostname"}getAllProvisioning(){return this.http.get(this.getAndPostAllProvisioningUrl)}postAllProvisioning(t){return this.http.post(this.getAndPostAllProvisioningUrl,t)}postProvisioningNtp(t){return this.http.post(this.PostProvisioningNtpUrl,t)}postProvisioningDns(t){return this.http.post(this.PostProvisioningDnsUrl,t)}postProvisioningHostName(t){return this.http.post(this.PostProvisioningHostnameUrl,{hostname:t})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(w.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),S=(()=>{class i{constructor(t,n){this.store=t,this.provisioningApiService=n}get provisioning(){return this.store.select(Y)}get nameServerIps(){return this.store.select(V)}get ntpIps(){return this.store.select(H)}setProvisioning(t){this.store.dispatch(P({provisioning:t}))}fetchProvisioning(){this.provisioningApiService.getAllProvisioning().subscribe(t=>{this.setProvisioning(t)})}sendProvisioning(t){return this.provisioningApiService.postAllProvisioning(t)}sendProvisioningNtp(t){return this.provisioningApiService.postProvisioningNtp(t)}sendProvisioningDns(t){return this.provisioningApiService.postProvisioningDns(t)}sendProvisioningHostname(t){return this.provisioningApiService.postProvisioningHostName(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(a.yh),e.LFG(A))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var f=l(77093),T=l(1769),h=l(98295),F=l(49983),b=l(67441),z=l(72458),O=l(51095);function $(i,o){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",29),e._uU(2),e.qZA(),e.BQk()),2&i){const t=o.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function j(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-select",28),e.NdJ("valueChange",function(r){const p=e.CHM(t).$implicit,d=e.oxw().$implicit,v=e.oxw();return p.onSelectChange(r,d.value,v.interfaces,v.networkingFormGoup)}),e.YNc(2,$,3,2,"ng-container",26),e.qZA(),e.qZA()}if(2&i){const t=o.$implicit,n=e.oxw().$implicit,r=e.oxw();e.xp6(1),e.Q6J("value",r.getSelectedOptionValue(n.key,t.fieldName)),e.xp6(1),e.Q6J("ngForOf",t.options)}}function B(i,o){if(1&i&&(e.TgZ(0,"div"),e.TgZ(1,"mat-form-field",30),e.TgZ(2,"mat-label"),e._uU(3),e.qZA(),e._UZ(4,"input",31),e.qZA(),e.qZA()),2&i){const t=o.$implicit,n=e.oxw(2);e.xp6(3),e.Oqu(t.displayName),e.xp6(1),e.Q6J("formControlName",t.fieldName)("type",n.getControlType(t))("placeholder",t.placeholder)}}function R(i,o){if(1&i&&(e.TgZ(0,"div",23),e.TgZ(1,"div",6),e.TgZ(2,"div",24),e.TgZ(3,"span",7),e._uU(4),e.qZA(),e.TgZ(5,"form",25),e.YNc(6,j,3,2,"mat-form-field",26),e.qZA(),e.qZA(),e._UZ(7,"mat-divider",8),e.qZA(),e.TgZ(8,"form",27),e.YNc(9,B,5,4,"div",26),e.qZA(),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.xp6(4),e.Oqu(t.key),e.xp6(1),e.Q6J("formGroupName",t.key),e.xp6(1),e.Q6J("ngForOf",n.getInlineSelectControls(t.value)),e.xp6(2),e.Q6J("formGroupName",t.key),e.xp6(1),e.Q6J("ngForOf",n.getInputFields(t.value))}}function K(i,o){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid IP address format, address should be between 0.0.0.0 and 255.255.255.255"),e.qZA())}function X(i,o){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Duplicate entry"),e.qZA())}function W(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e.TgZ(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"i",32),e.NdJ("click",function(){const s=e.CHM(t).index;return e.oxw().deleteNTP(s)}),e.qZA(),e.qZA()}if(2&i){const t=o.$implicit;e.xp6(2),e.Oqu(t)}}function ee(i,o){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid IP address format, address should be between 0.0.0.0 and 255.255.255.255"),e.qZA())}function te(i,o){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Duplicate entry"),e.qZA())}function ne(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e.TgZ(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"i",32),e.NdJ("click",function(){const s=e.CHM(t).index;return e.oxw().deleteDNS(s)}),e.qZA(),e.qZA()}if(2&i){const t=o.$implicit;e.xp6(2),e.Oqu(t)}}function ie(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",33),e.TgZ(1,"button",34),e.NdJ("click",function(){return e.CHM(t),e.oxw().saveChanges()}),e._uU(2,"Save Changes"),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){return e.CHM(t),e.oxw().cancelChanges()}),e._uU(4," Cancel Changes"),e.qZA(),e.qZA()}}const oe=[{path:"",component:(()=>{class i{constructor(t,n){this.interfacesMS=t,this.provisioningMS=n,this.networkingFormGoup=new c.cw({}),this.networkingFormFields=(0,u.cloneDeep)(L),this.dnsValue="",this.ntpIps=[],this.ntpValue="",this.ipv4PatternValidation=/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,this.subscriptions=[],this.interfaces=[],this.showSaveOrCancel=!1}ngOnInit(){this.dnsControl=new c.NI("",[c.kI.pattern(this.ipv4PatternValidation)]),this.ntpControl=new c.NI("",[c.kI.pattern(this.ipv4PatternValidation)]),Object.keys(this.networkingFormFields).forEach(t=>{var n,r,s;this.networkingFormFields.Interfaces.fields.find(d=>"interfaces"===d.fieldName).onSelectChange=this.setInterfaceFormFromName;let p=new c.cw({});null===(s=null===(r=null===(n=this.networkingFormFields)||void 0===n?void 0:n[t])||void 0===r?void 0:r.fields)||void 0===s||s.forEach(d=>{p.addControl(d.fieldName,new c.NI({value:"",disabled:d.disabled},d.validators))}),this.networkingFormGoup.addControl(t,p)}),this.interfacesMS.fetchInterfaces(),this.provisioningMS.fetchProvisioning(),this.subscriptions.push(this.provisioningMS.nameServerIps.subscribe(t=>{let n=(0,u.cloneDeep)(t);n&&(0,_.diff)(n,this.nameServerIps)&&(this.nameServerIps=n,this.tempNameServerIps=(0,u.cloneDeep)(n))}),this.provisioningMS.ntpIps.subscribe(t=>{let n=(0,u.cloneDeep)(t);n&&(0,_.diff)(n,this.ntpIps)&&(this.ntpIps=n,this.tempNtpIps=(0,u.cloneDeep)(n))}),this.provisioningMS.provisioning.subscribe(t=>{var n,r,s,p;t&&(null===(r=null===(n=this.networkingFormGoup)||void 0===n?void 0:n.controls)||void 0===r||r["Device Identity"].setValue({hostname:(null===(s=null==t?void 0:t.hostname)||void 0===s?void 0:s.hostname)?null===(p=null==t?void 0:t.hostname)||void 0===p?void 0:p.hostname:""}))}),this.interfacesMS.interfaces.subscribe(t=>{var n,r;t&&((0,_.diff)(this.interfaces,t)&&(this.interfaces=t),this.networkingFormFields.Interfaces.fields.find(s=>"interfaces"===s.fieldName).options=t.map(s=>s.name),(null===(r=null===(n=this.networkingFormGoup.get("Interfaces"))||void 0===n?void 0:n.get("interfaces"))||void 0===r?void 0:r.value)||(this.networkingFormGoup.get("Interfaces").get("interfaces").setValue(t),this.setInterfaceFormFromName("eth0",this.networkingFormFields.Interfaces,t,this.networkingFormGoup)))}))}getInterfaceFromName(t){var n;let r=this.interfaces.find(s=>s.name===t);return r||(r=null===(n=this.interfaces)||void 0===n?void 0:n[0]),r}getSelectedOptionValue(t,n){return this.networkingFormFields[t].fields.find(r=>r.fieldName===n).selectOptionValue}setInterfaceFormFromName(t,n,r,s){var p;n.fields.find(v=>"interfaces"===v.fieldName).selectOptionValue=t;let d=null==r?void 0:r.find(v=>v.name===t);d||(d=null==r?void 0:r[0]),null===(p=s.get("Interfaces"))||void 0===p||p.patchValue({hostname:d.name,mask:d.netmask,ipAddress:d.ipv4,gateway:d.gateway})}getInlineSelectControls(t){return t.fields.filter(n=>"Select"===n.type&&"inline"===n.display)}getInputFields(t){return t.fields.filter(n=>"Select"!==n.type)}getControlType(t){let n="";switch(t.type.toLowerCase()){case"number":n="number";break;case"string":case"stringtolist":n="text";break;case"date":n="datetime-local";break;case"select":n="select";break;case"file":n="file";break;default:n="text"}return n}checkPattern(t){return this.ipv4PatternValidation.test(t)}checkIfNtpExists(t){let n=!!t&&this.ntpIps.includes(t);return this.ntpControl.setErrors(n?{exists:!0}:null),n}checkIfDnsExists(t){let n=!!t&&this.nameServerIps.dns.ips.includes(t);return this.dnsControl.setErrors(n?{exists:!0}:null),n}showSaveOrCancelChanges(t=!0){this.showSaveOrCancel=t}addDNS(){var t,n,r;this.checkPattern(this.dnsControl.value)&&!this.checkIfDnsExists(this.dnsControl.value)&&(null===(r=null===(n=null===(t=this.nameServerIps)||void 0===t?void 0:t.dns)||void 0===n?void 0:n.ips)||void 0===r||r.push(this.dnsControl.value),this.dnsControl.setValue(""),this.showSaveOrCancelChanges())}deleteDNS(t){var n,r,s;null===(s=null===(r=null===(n=this.nameServerIps)||void 0===n?void 0:n.dns)||void 0===r?void 0:r.ips)||void 0===s||s.splice(t,1),this.showSaveOrCancelChanges()}addNTP(){console.log(this.ntpControl.errors),this.checkPattern(this.ntpControl.value)&&!this.checkIfNtpExists(this.ntpControl.value)&&(this.ntpIps.push(this.ntpControl.value),this.ntpControl.setValue(""),this.showSaveOrCancelChanges())}deleteNTP(t){this.ntpIps.splice(t,1),this.showSaveOrCancelChanges()}saveChanges(){this.provisioningMS.sendProvisioningDns(this.nameServerIps).subscribe(()=>{this.tempNameServerIps=(0,u.cloneDeep)(this.nameServerIps),this.provisioningMS.sendProvisioningNtp(this.ntpIps).subscribe(()=>{this.tempNtpIps=(0,u.cloneDeep)(this.ntpIps),this.showSaveOrCancelChanges(!1)})})}cancelChanges(){this.nameServerIps=(0,u.cloneDeep)(this.tempNameServerIps),this.ntpIps=(0,u.cloneDeep)(this.tempNtpIps),this.showSaveOrCancelChanges(!1)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(k),e.Y36(S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-networking"]],decls:42,vars:17,consts:[[1,"outer-div-padding"],["fxLayout","column","fxLayoutGap","32px",1,"page-components"],["fxLayout","column","fxLayoutGap","16px",3,"formGroup"],["fxLayout","column","fxLayoutGap","16px",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutGap","32px",1,"width100"],["fxLayout","column","fxLayoutGap","16px","fxFlex","49"],["fxLayout","column","fxLayoutGap","8px"],[1,"groupTitle"],["horizontal",""],["fxLayout","row wrap","fxLayoutGap","16px"],["appearance","outline","color","accent","fxFlex",""],["matInput","","type","text",3,"formControl","placeholder","keyup.enter"],["ntpInput",""],[4,"ngIf"],["fxLayoutAlign","center center","fxFlex","10"],[1,"bi","bi-plus-circle",3,"ngClass","click"],[1,"itemsListOuterDiv"],["fxLayout","row","fxLayoutAlign","space-between center",4,"ngFor","ngForOf"],["fxLayout","column","fxLayoutGap","8px",1,"width100"],["fxLayout","row wrap","fxLayoutGap","16px",1,"width100"],["dnsInput",""],["fxLayout","row","fxLayoutAlign","end center",2,"margin-top","32px"],["fxLayout","row","fxLayoutGap","16px",4,"ngIf"],["fxLayout","column","fxLayoutGap","16px"],["fxLayout","row","fxLayoutAlign","space-between center"],[3,"formGroupName"],[4,"ngFor","ngForOf"],["fxLayout","row wrap","fxLayoutGap","16px",3,"formGroupName"],[3,"value","valueChange"],[3,"value"],["appearance","outline","color","accent"],["matInput","",3,"formControlName","type","placeholder"],[1,"bi","bi-trash","deleteIcon",3,"click"],["fxLayout","row","fxLayoutGap","16px"],["mat-flat-button","","color","accent",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"form",2),e.YNc(3,R,10,5,"div",3),e.ALo(4,"keyvalue"),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"div",5),e.TgZ(7,"div",6),e.TgZ(8,"span",7),e._uU(9,"NTP configuration"),e.qZA(),e._UZ(10,"mat-divider",8),e.qZA(),e.TgZ(11,"div",9),e.TgZ(12,"mat-form-field",10),e.TgZ(13,"mat-label"),e._uU(14,"New NTP"),e.qZA(),e.TgZ(15,"input",11,12),e.NdJ("keyup.enter",function(){return n.addNTP()}),e.qZA(),e.YNc(17,K,2,0,"mat-error",13),e.YNc(18,X,2,0,"mat-error",13),e.qZA(),e.TgZ(19,"div",14),e.TgZ(20,"i",15),e.NdJ("click",function(){return n.addNTP()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"div",16),e.YNc(22,W,4,1,"div",17),e.qZA(),e.qZA(),e.TgZ(23,"div",5),e.TgZ(24,"div",18),e.TgZ(25,"span",7),e._uU(26,"DNS configuration"),e.qZA(),e._UZ(27,"mat-divider",8),e.qZA(),e.TgZ(28,"div",19),e.TgZ(29,"mat-form-field",10),e.TgZ(30,"mat-label"),e._uU(31,"new DNS "),e.qZA(),e.TgZ(32,"input",11,20),e.NdJ("keyup.enter",function(){return n.addDNS()}),e.qZA(),e.YNc(34,ee,2,0,"mat-error",13),e.YNc(35,te,2,0,"mat-error",13),e.qZA(),e.TgZ(36,"div",14),e.TgZ(37,"i",15),e.NdJ("click",function(){return n.addDNS()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(38,"div",16),e.YNc(39,ne,4,1,"div",17),e.qZA(),e.qZA(),e.qZA(),e.TgZ(40,"div",21),e.YNc(41,ie,5,0,"div",22),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Q6J("formGroup",n.networkingFormGoup),e.xp6(1),e.Q6J("ngForOf",e.lcZ(4,15,n.networkingFormFields)),e.xp6(12),e.Q6J("formControl",n.ntpControl)("placeholder","eg. 8.8.8.8"),e.xp6(2),e.Q6J("ngIf",!n.checkPattern(n.ntpControl.value)),e.xp6(1),e.Q6J("ngIf",n.checkIfNtpExists(n.ntpControl.value)),e.xp6(2),e.Q6J("ngClass",n.checkPattern(n.ntpValue)&&!n.checkIfNtpExists(n.ntpValue)?"addIcon":"disabledIcon"),e.xp6(2),e.Q6J("ngForOf",n.ntpIps),e.xp6(10),e.Q6J("formControl",n.dnsControl)("placeholder","eg. 8.8.8.8"),e.xp6(2),e.Q6J("ngIf",!n.checkPattern(n.dnsControl.value)),e.xp6(1),e.Q6J("ngIf",n.checkIfDnsExists(n.dnsControl.value)),e.xp6(2),e.Q6J("ngClass",n.checkPattern(n.dnsControl.value)&&!n.checkIfDnsExists(n.dnsControl.value)?"addIcon":"disabledIcon"),e.xp6(2),e.Q6J("ngForOf",null==n.nameServerIps||null==n.nameServerIps.dns?null:n.nameServerIps.dns.ips),e.xp6(2),e.Q6J("ngIf",n.showSaveOrCancel))},directives:[f.xw,f.SQ,c._Y,c.JL,c.sg,g.sg,f.yH,T.d,h.KE,h.hX,F.Nt,c.Fj,c.JJ,c.oH,g.O5,f.Wh,g.mk,c.F,c.x0,b.gD,z.ey,c.u,h.TO,O.lW],pipes:[g.Nd],styles:[".groupTitle[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.itemsListOuterDiv[_ngcontent-%COMP%]{padding:0 32px}.itemsListOuterDiv[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:5px;border-radius:5px}.itemsListOuterDiv[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover{background-color:var(--grey-color)}.width100[_ngcontent-%COMP%]{width:100%}.addIcon[_ngcontent-%COMP%]:hover{color:var(--accent-color)}.addIcon[_ngcontent-%COMP%]{cursor:pointer}.disabledIcon[_ngcontent-%COMP%]{color:var(--primary-color);cursor:unset}.deleteIcon[_ngcontent-%COMP%]{cursor:pointer}.deleteIcon[_ngcontent-%COMP%]:hover{color:var(--error-color)}"]}),i})()},{path:"**",redirectTo:""}];let re=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[C.Bz.forChild(oe)],C.Bz]}),i})(),se=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[A,k,S,Z],imports:[[g.ez,a.Aw.forFeature(m),a.Aw.forFeature(N)]]}),i})(),ae=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[g.ez,re,se,c.UX,c.u5,f.ae,h.lN,F.c,O.ot,b.LD,T.t]]}),i})()}}]);